package eu.quanticol.moonlight.xtext.tests;

import static org.junit.jupiter.api.Assertions.*;

import java.io.File;
import java.io.IOException;

import eu.quanticol.moonlight.SpatialTemporalScriptComponent;
import eu.quanticol.moonlight.TemporalScriptComponent;
import org.junit.jupiter.api.Test;

import eu.quanticol.moonlight.MoonLightScript;
import eu.quanticol.moonlight.xtext.ScriptLoader;

class TestScriptLoader {

	@Test
	void testLoadScriptFromCodeQualitative() throws IOException {
		ScriptLoader loader = new ScriptLoader();
		MoonLightScript script = loader.compileScript("type poiType = BusStop|Hospital|MetroStop|MainSquare|Museum;		\n" + 
				"				signal { bool taxi; int peole; }\n" + 
				"				space { locations {poiType poi; }\n" + 
				"				edges { real length; }\n" + 
				"				}\n" + 
				"				domain boolean;\n" + 
				"				formula aFormula = somewhere [0.0, 1.0] ( taxi );\n");
		assertNotNull(script);
		
	}
		
	@Test
	void testLoadScriptFromCodeWithParameters() throws IOException {
		ScriptLoader loader = new ScriptLoader();
		MoonLightScript script = loader.compileScript("type poiType = BusStop|Hospital|MetroStop|MainSquare|Museum;		\n" + 
				"				signal { bool taxi; int peole; }\n" + 
				"				space { locations {poiType poi; }\n" + 
				"				edges { real length; "
				+ "						int hop; "
				+ "				}\n" + 
				"				}\n" + 
				"				domain boolean;\n" + 
				"				formula aFormula(real distance) = somewhere(hop) [0, distance] ( taxi );\n");
		assertNotNull(script);
		
	}

	@Test
	void testLoadScriptFromFile() throws IOException {
		ScriptLoader loader = new ScriptLoader();
		File file = new File(getClass().getClassLoader().getResource("testscript.mls").getFile());
		MoonLightScript script = loader.loadFile(file.getAbsolutePath());
		assertNotNull(script);
	}

//	@Test
//	void name() {
//		ScriptLoader loader = new ScriptLoader();
//		MoonLightScript script = loader.loadFile("C:\\Users\\Simone\\Documents\\git\\MoonLight\\api_resources\\testscript.mls");
//		System.out.println();
//
//
//	}


	@Test
	void testFailing() throws IOException {
		ScriptLoader scriptLoader = new ScriptLoader();
		MoonLightScript moonLightScript = scriptLoader.compileScript("signal { int nodeType; real battery; real temperature; }\n" +
				"space { edges { int hop; real dist; } }\n" +
				"domain boolean;\n" +
				"formula atom = (nodeType==3) ;\n" +
				"formula P1 = atom reach (hop)[0, 1] (nodeType==2 | nodeType==1);\n" +
				"formula Ppar (int k) = atom reach (hop)[0, k] ( nodeType== 1) ;\n" +
				"formula P2 = escape(hop)[5, inf] (battery > 0.5) ;\n" +
				"formula P3 = somewhere(hop)[0, 3] (battery > 0.5) ;\n" +
				"formula P4 = (nodeType==3) reach (hop)[0, 1]{(nodeType==2) reach (hop)[0, 5] (nodeType==1)};\n" +
				"formula Pnest = everywhere(dist)[0, inf]P3;\n" +
				"formula ReachQ = (temperature > 10)reach(hop)[0, 10] (battery > 0.5);\n" +
				"formula SensNetk = somewhere(hop)[0, 3] (battery > 0.5);\n" +
				"formula SensBool = everywhere(hop)[0, 5] (nodeType==2);\n" +
				"formula Pbattery = !atom => {!atom reach (hop)[0, 2] (battery > 0.5)};\n" +
				"formula P5 = globally (battery > 0.5)\n" +
				"formula P6 = eventually(battery > 0.5)");
		moonLightScript.setMinMaxDomain();
		SpatialTemporalScriptComponent<?> p6 = moonLightScript.spatialTemporal().selectSpatialTemporalComponent("P6");


		double[] times = new double[]{1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0};
		double[] signalTimeArray = new double[]{1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0};
		double[][][] graph = {{{0.0, 1.0, 1.0, 169.07015300914216}, {0.0, 5.0, 1.0, 151.21460159550827}, {1.0, 0.0, 1.0, 169.07015300914216}, {1.0, 5.0, 1.0, 121.01336003854118}, {2.0, 4.0, 1.0, 230.592966244818}, {4.0, 2.0, 1.0, 230.592966244818}, {4.0, 7.0, 1.0, 174.8799776551102}, {5.0, 0.0, 1.0, 151.21460159550827}, {5.0, 1.0, 1.0, 121.01336003854118}, {7.0, 4.0, 1.0, 174.8799776551102}}, {{0.0, 1.0, 1.0, 167.32213073810806}, {0.0, 5.0, 1.0, 127.66509832607362}, {1.0, 0.0, 1.0, 167.32213073810806}, {1.0, 5.0, 1.0, 120.41998351015053}, {2.0, 4.0, 1.0, 243.5185313419679}, {4.0, 2.0, 1.0, 243.5185313419679}, {4.0, 7.0, 1.0, 160.2710820325407}, {5.0, 0.0, 1.0, 127.66509832607362}, {5.0, 1.0, 1.0, 120.41998351015053}, {7.0, 4.0, 1.0, 160.2710820325407}}, {{0.0, 1.0, 1.0, 166.44364827169596}, {0.0, 5.0, 1.0, 117.40694911908889}, {1.0, 0.0, 1.0, 166.44364827169596}, {1.0, 5.0, 1.0, 121.87648797544637}, {4.0, 7.0, 1.0, 137.72458605457714}, {5.0, 0.0, 1.0, 117.40694911908889}, {5.0, 1.0, 1.0, 121.87648797544637}, {7.0, 4.0, 1.0, 137.72458605457714}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}, {{0.0, 1.0, 1.0, 166.37761413582615}, {0.0, 5.0, 1.0, 111.44218029630382}, {1.0, 0.0, 1.0, 166.37761413582615}, {1.0, 5.0, 1.0, 117.17308681680899}, {4.0, 7.0, 1.0, 123.29161371633333}, {5.0, 0.0, 1.0, 111.44218029630382}, {5.0, 1.0, 1.0, 117.17308681680899}, {7.0, 4.0, 1.0, 123.29161371633333}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}, {{0.0, 1.0, 1.0, 164.02750334799686}, {0.0, 5.0, 1.0, 90.21085718456469}, {1.0, 0.0, 1.0, 164.02750334799686}, {1.0, 5.0, 1.0, 119.62066911632445}, {4.0, 7.0, 1.0, 101.7316200708556}, {5.0, 0.0, 1.0, 90.21085718456469}, {5.0, 1.0, 1.0, 119.62066911632445}, {7.0, 4.0, 1.0, 101.7316200708556}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}, {{0.0, 1.0, 1.0, 162.6612022144707}, {0.0, 5.0, 1.0, 72.61630484217754}, {1.0, 0.0, 1.0, 162.6612022144707}, {1.0, 5.0, 1.0, 126.71688757526483}, {4.0, 7.0, 1.0, 91.88924696474663}, {5.0, 0.0, 1.0, 72.61630484217754}, {5.0, 1.0, 1.0, 126.71688757526483}, {7.0, 4.0, 1.0, 91.88924696474663}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}, {{0.0, 1.0, 1.0, 161.43048995986902}, {0.0, 5.0, 1.0, 54.69541910379974}, {1.0, 0.0, 1.0, 161.43048995986902}, {1.0, 5.0, 1.0, 135.45557616331018}, {4.0, 7.0, 1.0, 89.66855190486653}, {5.0, 0.0, 1.0, 54.69541910379974}, {5.0, 1.0, 1.0, 135.45557616331018}, {7.0, 4.0, 1.0, 89.66855190486653}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}, {{0.0, 1.0, 1.0, 160.26737055482238}, {0.0, 5.0, 1.0, 41.20972134930163}, {1.0, 0.0, 1.0, 160.26737055482238}, {1.0, 5.0, 1.0, 141.70049771158668}, {4.0, 7.0, 1.0, 65.80657155591152}, {5.0, 0.0, 1.0, 41.20972134930163}, {5.0, 1.0, 1.0, 141.70049771158668}, {7.0, 4.0, 1.0, 65.80657155591152}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}, {{0.0, 1.0, 1.0, 159.85928965229812}, {0.0, 5.0, 1.0, 36.362100626934634}, {1.0, 0.0, 1.0, 159.85928965229812}, {1.0, 5.0, 1.0, 146.18698814106978}, {4.0, 7.0, 1.0, 61.92522452947611}, {5.0, 0.0, 1.0, 36.362100626934634}, {5.0, 1.0, 1.0, 146.18698814106978}, {7.0, 4.0, 1.0, 61.92522452947611}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}, {{0.0, 1.0, 1.0, 159.59527052207852}, {0.0, 5.0, 1.0, 33.00831252572609}, {1.0, 0.0, 1.0, 159.59527052207852}, {1.0, 5.0, 1.0, 152.79872268341097}, {4.0, 7.0, 1.0, 45.98646480581203}, {5.0, 0.0, 1.0, 33.00831252572609}, {5.0, 1.0, 1.0, 152.79872268341097}, {7.0, 4.0, 1.0, 45.98646480581203}, {0.0, 0.0, 0.0, 0.0}, {0.0, 0.0, 0.0, 0.0}}};
		double[][][] signalValues = {{{1.0, 0.021555887203496993, 18.87463082391583}, {1.0, 0.40672691508936376, 7.77767551824857}, {1.0, 0.27528695131569003, 11.49474321712816}, {1.0, 0.5153672192115724, 6.48439840588098}, {1.0, 0.8266295066188918, 10.076801636936958}, {1.0, 0.36003104208577164, 2.1866847904869147}, {1.0, 0.01962106676558406, 2.863120441671523}, {1.0, 0.9419189303112829, 17.337741093450155}, {1.0, 0.2435733726809508, 3.4978413067156566}, {1.0, 0.7059507542488834, 6.360382349934701}}, {{3.0, 0.5598407058725097, 10.983161748398054}, {3.0, 0.6669315332074987, 9.094836560782236}, {3.0, 0.7166697406391417, 6.520843418455826}, {3.0, 0.657530542095911, 6.0345355440929405}, {3.0, 0.3945346842330335, 12.256191776711184}, {3.0, 0.4542123718533986, 7.7986131431297}, {3.0, 0.4351755456969518, 11.187411448060079}, {3.0, 0.6559138202571413, 8.135535204304512}, {3.0, 0.7850700819340061, 2.772979431851905}, {3.0, 0.6451287866073825, 12.172708612699791}}, {{3.0, 0.3008190180694891, 14.567736491887134}, {3.0, 0.9337256595459297, 4.933743952761585}, {3.0, 0.2833843816289363, 9.12849201703494}, {3.0, 0.9509151982649592, 0.23361982260679204}, {3.0, 0.613474881705262, 16.38844484463752}, {3.0, 0.3863898985921723, 11.818094608106728}, {3.0, 0.8322214752828176, 0.09159247894646949}, {3.0, 0.4519457092603858, 2.2523028205009354}, {3.0, 0.07408957686092688, 11.9777122073573}, {3.0, 0.5523098445077299, 18.203904533889634}}, {{3.0, 0.9394097138734583, 11.535165957160196}, {3.0, 0.8109500322382651, 15.688461860483542}, {3.0, 0.8961988568494954, 14.27591166466269}, {3.0, 0.7223485143274979, 10.798101876992504}, {3.0, 0.8186407350822091, 10.637783389858516}, {3.0, 0.7755546422505355, 9.187600959326508}, {3.0, 0.6173901714540843, 15.333639972429749}, {3.0, 0.839697420719669, 8.876916734539147}, {3.0, 0.39388342698169665, 18.02115811365451}, {3.0, 0.21810872978328, 18.181963756017645}}, {{3.0, 0.980903636046859, 0.5171494216627925}, {3.0, 0.4845482718349904, 17.65675211166105}, {3.0, 0.8265788923135602, 17.6881009055199}, {3.0, 0.4000797453623376, 1.907453852556431}, {3.0, 0.8862350390626065, 4.041501930968632}, {3.0, 0.7342711056859393, 1.0067997347790825}, {3.0, 0.520129415310742, 16.974184529165647}, {3.0, 0.5326235024743463, 6.003688024278}, {3.0, 0.003394122964307411, 18.787595317684765}, {3.0, 0.7723662136130426, 11.831888178148757}}, {{3.0, 0.28662038889425934, 8.930619565696286}, {3.0, 0.7567492100655122, 18.27423362586036}, {3.0, 0.3900265128139977, 14.41711341633863}, {3.0, 0.83187133932981, 2.93029712884463}, {3.0, 0.9311116274872206, 9.077869313610439}, {3.0, 0.43027784507415556, 4.573751680404417}, {3.0, 0.8638682229336107, 18.33642540507476}, {3.0, 0.553887065791275, 8.027737076289856}, {3.0, 0.22067689193302398, 4.4236891187815575}, {3.0, 0.22802832360045022, 6.651428146711023}}, {{3.0, 0.8008202869515346, 12.92603914701311}, {3.0, 0.41704745374276697, 11.1656984724455}, {3.0, 0.4979029429641866, 0.37225549452772233}, {3.0, 0.13433834172870818, 12.6228241402991}, {3.0, 0.1907846480091222, 8.558218396403417}, {3.0, 0.6937525741339134, 16.68378122113799}, {3.0, 0.09769791816144313, 19.739365495673162}, {3.0, 0.6800655300833607, 16.667271269062688}, {3.0, 0.0013005687005961386, 9.653427507928276}, {3.0, 0.3708647189734052, 17.061272584198385}}, {{2.0, 0.8961113514326038, 10.424059053448364}, {2.0, 0.971785992989294, 11.977362054924107}, {2.0, 0.6948051926724939, 13.495529342565716}, {2.0, 0.06046677193982841, 17.186408228575708}, {2.0, 0.25858225141877234, 19.32105499223998}, {2.0, 0.9452134871684603, 0.31289385393054037}, {2.0, 0.9080522031867692, 10.10266203597645}, {2.0, 0.3671899053173674, 8.072573255472141}, {2.0, 0.1891796709947352, 7.520222318495091}, {2.0, 0.8909288210256949, 8.847957860823302}}, {{3.0, 0.5975265768178296, 7.446253215590241}, {3.0, 0.987974701230832, 2.9775344067509812}, {3.0, 0.8343690010999377, 8.770176484730257}, {3.0, 0.08424705231465957, 19.484432624774264}, {3.0, 0.8978656848402992, 12.401101082669474}, {3.0, 0.7842325982317409, 17.274217301117314}, {3.0, 0.10801669413675896, 5.4284324883503015}, {3.0, 0.23929060619354536, 7.803518762612132}, {3.0, 0.14248405482097148, 10.47560073931739}, {3.0, 0.8563769077282607, 18.087109564358876}}, {{3.0, 0.8840167357238198, 18.742693326831244}, {3.0, 0.8641475290312027, 17.99426969071477}, {3.0, 0.6096296896757324, 8.756403583325401}, {3.0, 0.16389831832970825, 11.41676854944367}, {3.0, 0.5933618603861089, 13.907799038360071}, {3.0, 0.7055718581310688, 1.5613810606486855}, {3.0, 0.5169967580969449, 2.0150102384247126}, {3.0, 0.5789234924590936, 7.208977867578891}, {3.0, 0.268075999123376, 5.297451870971797}, {3.0, 0.40243354981344415, 0.6635881190425486}}};

		p6.monitorToObjectArrayAdjacencyList(times, graph, signalTimeArray, signalValues);
		System.out.println();
	}

}
